<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Job Details</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static',filename='css/product_view.css') }}">
</head>
<body>
  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="flash-container">
      {% for category, message in messages %}
        <div class="flash {{ category }}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<!-- ================= NAVBAR ================= -->
<header class="navbar">
  <div class="logo">
    <i class="fa-solid fa-industry"></i>
    <div>
      <strong>IndusTech</strong><br>
      <small>Industrial Ecosystem</small>
    </div>
  </div>

  <nav class="nav-links">
    <a href="{{ url_for('home') }}" > <i class="fa-solid fa-house"></i> Home</a>
    <a href="{{url_for('industrymap') }}">  <i class="fa-solid fa-location-dot"></i> Industrial Map</a>
    <a href="{{url_for('jobportal')}}"> <i class="fa-solid fa-briefcase"></i> Job Portal</a>
    <a href="{{url_for('trade') }}" class="active"> <i class="fa-solid fa-box"></i> B2B Trade</a>
  </nav>

  <div class="auth">
    {% if session.get('user_type') == 'worker' %}
      <a href="{{ url_for('workerprofile') }}" class="profile"> <i class='fa-solid fa-user'></i> My profile</a>
    <a href="{{ url_for('logout') }}" class="signup">Logout</a>
    {% elif session.get('user_type') == 'company' %}
    <a href="{{ url_for('companyprofile') }}" class="profile"> <i class='fa-solid fa-user'></i> My profile</a>
    <a href="{{ url_for('logout') }}" class="signup">Logout</a>
    {% else %}
    <a href="{{ url_for('login') }}" class="signup">Login</a>
    {% endif %}
  </div>
</header>

<div class="container">
  <a href="#" class="back">‚Üê Back to Jobs</a>

  <div class="main">

    <!-- LEFT COLUMN -->
    <div class="left">

      <!-- JOB CARD -->
      <div class="card job-card">

        <div class="job-layout">

          <!-- INFO (LEFT) -->
          <div class="job-info">
            <div class="title-row">
              <div>
                <h2>{{ sell.sell_name }}</h2>
                <p class="company">{{ sell.company.company_name }}</p>
              </div>
             
              <div class="job-header-actions">
                <button class="icon-btn" title="Save Job">
                  <i class="fa-regular fa-heart"></i>
                </button>
            
                <button class="icon-btn" id="shareJobBtn"  title="Share Job">
                  <i class="fa-solid fa-share-nodes"></i>
                </button>
              </div>

            </div>

            <div class="salary">Sell Price : {{ sell.sell_price }}Rs/Per Unit</div>

            <div class="tags">
              <span>üìç Minimum Order Quantity : {{ sell.sell_quantity }}</span>
              <!-- <span>‚è∞ 11:29 AM ‚Äì 08:30 PM</span>
              <span>üë• 9 Openings</span>
              <span>üî• Part Time</span> -->
            </div>

            <div class="section">
              <h3>Product Category : {{ sell.sell_category }}</h3>
            </div>

            <div class="section">
              <h3>Product Description</h3>
              <p>{{ sell.sell_description }}</p>
            </div>
          </div>

          <!-- IMAGE (RIGHT) -->
          <div class="job-image" onclick="event.stopPropagation()">

            {% if images and images|length > 0 %}
          
              <!-- IMAGE CAROUSEL -->
              <div class="job-carousel"
                   data-images='{{ images | tojson }}'
                   data-index="0">
          
                <button class="carousel-btn left"
                        onclick="event.stopPropagation(); prevImg(this)">‚Äπ</button>
          
                <img class="job-img"
                     src="{{ url_for('static', filename='uploads/sell_items/' ~ images[0]) }}"
                     alt="Product Image"
                     onclick="event.stopPropagation()">
          
                {% if images|length > 1 %}
                <button class="carousel-btn right"
                        onclick="event.stopPropagation(); nextImg(this)">‚Ä∫</button>
                {% endif %}
          
              </div>
          
            {% else %}
          
              <!-- FALLBACK ICON -->
              <div class="product-image">
                <i class="fa-solid fa-box"></i>
              </div>
          
            {% endif %}
          
          </div>
          

        </div>
      </div>

      
    <!-- ===== COMPANY INFO ===== -->
  <section class="card company-card">
    <h3>About the Company</h3>
  
    <a href="{{ url_for('companyprofile_public', company_id=sell.company.id) }}" class="company-link"> 
        <div class="company-box">
          <div class="company-icon">
            <i class="fa-solid fa-industry"></i>
          </div>
      
          <div class="company-details">
            <h4 class="company-name-title">{{ sell.company.company_name }}</h4>
            <p class="company-type">{{ sell.company.company_category or "Industry" }}</p>
      
            <div class="company-meta">
              <span>{{ sell.company.company_city | title }}</span>
              <span>{{ sell.company.company_size or "" }}</span>
            </div>
          </div>
        </div>
      </a>      
  </section>

    </div>

    <!-- ===== RIGHT CARD ===== -->
    <div class="apply-card">

      <!-- ================= SUMMARY VIEW ================= -->
      <div id="applySummary">
    
        <h3>Ready to Apply?</h3>
    
       
    
        <button class="apply-btn" onclick="showApplyForm()">
          <i class="fa-regular fa-circle-check"></i> Apply Now
        </button>
    
        <a href="tel:{{ sell.company.email }}" class="contact-btn">
          <i class="fa-solid fa-phone"></i> Contact Company
        </a>
    
        <p class="posted-date">
          Posted on {{ sell.created_at.strftime("%d %b %Y") }}
        </p>
    
      </div>

  
  
  <!-- ================= APPLY FORM VIEW ================= -->
  <div id="applyFormContainer" style="display:none;">
    <h3>Apply for this Job</h3>

    <form method="POST" action="{{ url_for('apply_trade') }}">
      <input type="hidden" name="sell_id" value="{{ sell.sell_id }}">
    
      <div class="form-group">
        <label>Quantity</label>
        <input type="number" name="quantity" required>
      </div>
    
      <div class="form-group">
        <label>Expected Price</label>
        <input type="number" step="0.01" name="expected_price">
      </div>
    
      <div class="form-group">
        <label>Message</label>
        <input name="message">
      </div>
    
      <button type="submit" class="apply-btn full">
        Submit Application
      </button>
    

      <button type="button" class="contact-btn outline"
              onclick="cancelApplyForm()">
        Cancel
      </button>

    </form>
</div>
  </div>

  <footer>
    <div class="footer-content">
        <div class="footer-section">
            <h4>IndusTech</h4>
            <p>Connecting India's industrial workforce with opportunities.</p>
        </div>
        <div class="footer-section">
            <h4>Quick Links</h4>
            <a href="home.html">Home</a>
            <a href="job-portal.html">Find Jobs</a>
            <a href="industry-map.html">Industry Map</a>
            <a href="b2btrade.html">B2B Trade</a>
        </div>
        <div class="footer-section">
            <h4>Support</h4>
            <a href="#">Help Center</a>
            <a href="#">Contact Us</a>
            <a href="#">Privacy Policy</a>
            <a href="#">Terms of Service</a>
        </div>
    </div>
</footer>
<script>
  const images = [
    {% for img in images %}
      "{{ url_for('static', filename='uploads/sell_items/' ~ img) }}",
    {% endfor %}
  ];

  let currentIndex = 0;

</script>
<script>
function nextImg(btn) {
  const carousel = btn.closest('.job-carousel');
  const images = JSON.parse(carousel.dataset.images);
  let index = parseInt(carousel.dataset.index);

  index = (index + 1) % images.length;
  carousel.dataset.index = index;

  carousel.querySelector('.job-img').src =
    `/static/uploads/sell_items/${images[index]}`;
}

function prevImg(btn) {
  const carousel = btn.closest('.job-carousel');
  const images = JSON.parse(carousel.dataset.images);
  let index = parseInt(carousel.dataset.index);

  index = (index - 1 + images.length) % images.length;
  carousel.dataset.index = index;

  carousel.querySelector('.job-img').src =
    `/static/uploads/sell_items/${images[index]}`;
}
</script>
<script>
  function showApplyForm() {
    document.getElementById("applySummary").style.display = "none";
    document.getElementById("applyFormContainer").style.display = "block";
  }
  
  function cancelApplyForm() {
    document.getElementById("applyFormContainer").style.display = "none";
    document.getElementById("applySummary").style.display = "block";
  }
  </script>
  
  
<script>
    document.getElementById("shareJobBtn").addEventListener("click", async () => {
      const shareData = {
        title: "Production Helper - IndusTech",
        text: "Check out this job opening at ABC Manufacturing Pvt Ltd",
        url: window.location.href
      };
  
      // ‚úÖ Modern mobile & supported browsers
      if (navigator.share) {
        try {
          await navigator.share(shareData);
        } catch (err) {
          console.log("Share cancelled");
        }
      } 
      // üß† Desktop fallback
      else {
        navigator.clipboard.writeText(shareData.url);
        alert("Job link copied to clipboard!");
      }
    });
  </script>
  
<script src="{{ url_for('static', filename='js/product_view.js') }}"></script>
</body>
</html>
